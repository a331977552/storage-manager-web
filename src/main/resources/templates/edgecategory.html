<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />
<title>Storage System</title>
<link th:href="@{/dist/css/bootstrap-editable.css}" rel="stylesheet">


<title th:replace="header_link.html"></title>
</head>

<body class="hold-transition skin-blue sidebar-mini ">

	<div class="modal modal-danger fade" id="modal-delete">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span></button> -->
					<h4 class="modal-title">warning</h4>
				</div>
				<div class="modal-body">
					<p id="modal-body-info">are you sure you want to delete this
						category?</p>

				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-dismiss="modal">No</button>
					<button id="btn_delete_category" type="button"
						class="btn btn-default" data-dismiss="modal">Yes</button>
					<!-- <button type="button" class="btn btn-primary">ok</button> -->
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal-dialog -->
	</div>
	<div class="modal modal-default fade" id="modal-info">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title">adding category</h4>
				</div>
				<div class="modal-body">
					<form id="addCategory" role="form" onsubmit="return false;"  onkeydown="if(event.keyCode==13)return false;">
						<input type="hidden" th:name="${_csrf.parameterName}"
							th:value="${_csrf.token}" />
						<div class="box-body">
							<div class="form-group">
								<label class="control-label" for="barcode"> <i
									class="fa fa-times-circle-o hidden"></i> category's name
								</label> <input type="text" name="name" class="form-control" id="name"
									placeholder="category's name">
								<p class="help-block hidden">required</p>
							</div>

						</div>
					</form>
					<p id="modal-body-info">success</p>
					<div id="modal-progressbar" class="progress active">
						<div
							class="progress-bar progress-bar-primary progress-bar-striped"
							role="progressbar" aria-valuenow="100" aria-valuemin="0"
							aria-valuemax="100" style="width: 100%">
							<span class="sr-only">processing</span>

						</div>
					</div>

				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default"
						id="btn_submit_add_category">add</button>

					<button type="button" class="btn btn-default" data-dismiss="modal">cancel</button>
				</div>

			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal-dialog -->
	</div>
	<div class="modal modal-default fade" id="modal-reminder">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
					<h4 class="modal-title">remind</h4>
				</div>
				<div class="modal-body">			
					<p id="modal-body-info">success</p>					
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal"
						>ok</button>

					<button type="button" class="btn btn-default" data-dismiss="modal">cancel</button>
				</div>

			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal-dialog -->
	</div>
	<div class="wrapper">

		<!-- Main Header -->
		<div th:replace="header.html"></div>
		<!-- Left side column. contains the logo and sidebar -->
		<div th:replace="left_sidebar.html"></div>



		<!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper">
			<!-- Content Header (Page header) -->
			<section class="content-header">
				
				<h1>
				Editing<small> Category </small>
				</h1>
				
		<ol class="breadcrumb">
        <li><a th:href="@{/}"><i class="fa fa-dashboard"></i>home</a></li>
        <li class="active">edit category</li>
      </ol>
			</section>

			<!-- Main content -->
			<section class="content container-fluid">

				<div class="row">
					<div class="col-xs-12">
						<div class="box">
							<div class="box-header">
								<h3 class="box-title">Category Edit</h3>
								<button class="btn-default" id="btn_add_category"
									style="margin-left: 10px;" th:text="#{common.add}">add</button>
								<div class="box-tools">

									<div class="input-group input-group-sm" style="width: 150px;">

										<input type="text" name="table_search"
											class="form-control pull-right" placeholder="Search">

										<div class="input-group-btn">
											<button type="submit" class="btn btn-default">
												<i class="fa fa-search"></i>
											</button>
										</div>
									</div>
								</div>
							</div>
							<!-- /.box-header -->
							<div class="box-body table-responsive no-padding">
								<table id="user" class="table table-hover">
									<tbody id="tbody">
										<tr>
											<th>index</th>

											<th th:text="#{common.name}">name</th>
											<th th:text="#{common.operation}">operation</th>
										</tr>
										<tr th:each="cate,stat:${categories}">
											<td width="10%" th:text="${stat.index}">John Doe</td>
											<td width="80%"><a th:text="${cate.name}"
												class="editable editable-click" href="#" data-type="text"
												data-original-title="" title="" data-title="enter new name"
												th:data-pk="${cate.id}" id="cate_name">11-7-2014</a></td>
											<td width="10%"><a class="btn-link" href="#"
												data-toggle="popover" th:data-id="${cate.id}" th:text="#{common.delete}">delete</a></td>
										</tr>

									</tbody>
								</table>
							</div>


							<!-- /.box-body -->
							<div class="box-footer clearfix">
								<ul class="pagination pagination-sm no-margin pull-right ">
									<li class="paginate_button previous disabled"><a href="#">«</a></li>
									<li><a href="#">1</a></li>
									<li class="paginate_button next disabled"><a href="#">»</a></li>
								</ul>
							</div>
						</div>
						<!-- /.box -->
					</div>


				</div>

			</section>
			<!-- /.content -->
		</div>
		<!-- /.content-wrapper -->

		<!-- Main Footer -->

		<div th:replace="footer.html"></div>


	</div>
	<!-- ./wrapper -->

	<!-- REQUIRED JS SCRIPTS -->

	<!-- jQuery 3 -->
	<script th:src="@{/bower_components/jquery/dist/jquery.min.js}"></script>
	<!-- Bootstrap 3.3.7 -->
	<script
		th:src="@{/bower_components/bootstrap/dist/js/bootstrap.min.js}"></script>
	<!-- AdminLTE App -->
	<script th:src="@{/dist/js/adminlte.min.js}"></script>
	<script th:src="@{/bower_components/ckeditor/ckeditor.js}"></script>
	<script th:src="@{/dist/js/bootstrap-editable.js}"></script>
		<script type="text/javascript" th:src="@{/dist/js/my_language.js}"></script>
	<script th:inline="javascript">
		$(document).ready(function() {
			
		
			$("#li_edit_category").addClass("active");
	
			var token = $("meta[name='_csrf']").attr("content");
			var header = $("meta[name='_csrf_header']").attr("content");
			$(document).ajaxSend(function(e, xhr, options) {
			    xhr.setRequestHeader(header, token);
			});
			
		
			function init(){
					
				
			       var url = [[@{/}]]+"category/update";
			    	url=url.replace("\\","");
		        	
				 //defaults
				   $.fn.editable.defaults.url = url; 

				    //enable / disable
				   $('#enable').click(function() {
				       $('#user .editable').editable('toggleDisabled');
				   });    
				    
					    //editables 
					    $('#user a.editable').editable({
					        type: 'text',
					        url: url,				     
					        title: 'enter new name',
					        ajaxOptions: {
					            dataType: 'json',
					            type:'post'
					         
					        },
					        success: function(response, newValue) {				        
					            if(!response) {
					                return "Unknown error!";
					            }          
					            
					            if(response.success === false) {
					                 return response.msg;
					            }
					        }        
					    });
					    
					    $("#user a.btn-link").click(function (){
					    	var id=$(this).data("id");
					    	$('#modal-delete').modal({
								backdrop:"static",
								keyboard:false
							});
					    	$("#btn_delete_category").data("id",id);
	
					    });
				        $("#btn_delete_category").click(function (){

						   var context = [[@{/}]]+"category/delete/"+$("#btn_delete_category").data("id");
					        	context=context.replace("\\","");

					    	$.ajax({
					    		   url:  context,
								   type: 'get',
								   
								   async: true,
	
								   dataType:"json",
								   success: function (result) {						
									 	if(result.code==200){								 		
									 		var id=$("#btn_delete_category").data("id");							
									 	var pa=	$("#user a[data-pk="+id+"]").parent().parent();
									 		pa.remove();
									 	showMsg(result.msg);
									 	}else{
									 		showMsg(result.msg);						 	
									  	}
								 	},
								   error:function(error,error1,error2){								  							 		
								   	showMsg("error: "+error);
								   },
					    	});
				     
				        });
			
				        };
			       
			init();
				    $("#btn_add_category").click(function (){
						$('#modal-info').find("div.modal-body").children("p").eq(0).hide();	
						$("#modal-progressbar").hide();
						$("#addCategory").show();	
					    $('#modal-info').modal();				 
				  	}); 
				 
				  
			      	
				 $("#btn_submit_add_category").click(function(){
					$("#btn_submit_add_category").attr("disabled",true);
					
					   var context = [[@{/}]]+"category/add";
				        	context=context.replace("\\","");
				        var nameVal=$("#name").val();
				       var helpInfo= $('#modal-info').find("div.modal-body").children("p").eq(0);				
						$("#modal-progressbar").show();
						helpInfo.hide();
						$("#addCategory").hide();	
				    	$.ajax({
				    		url:  context,
							   type: 'post',
							   data:{name:nameVal},
							   async: true,

							   dataType:"json",
							   success: function (result) {						
							 	if(result.code==200){
							 		$("#addCategory")[0].reset();
							 		helpInfo.text(result.msg).show();							 
									$("#modal-progressbar").hide();
									$("#addCategory").hide();
									
									
									addColumn(result);
									init();
									setTimeout(function(){
										$('#modal-info').modal('hide');
									 	$("#btn_submit_add_category").removeAttr("disabled");
									},800);
								 		
							 	}else{
							 		helpInfo.text(result.msg).show();		
							 		
									$("#modal-progressbar").hide();
									$("#addCategory").show();
							 	$("#btn_submit_add_category").removeAttr("disabled");
							 	}
							   },
							   error:function(error,error1,error2){								  							 		
								   	helpInfo.text(error).show();
									$("#modal-progressbar").hide();
									$("#addCategory").show();
									$("#btn_submit_add_category").removeAttr("disabled");
							   },
				    	});
					 
				 }); 
				 
	
				    
				
				
				
				
			
			
		
		
			
		});
		
		function showMsg(msg){			
			$('#modal-reminder').find("div.modal-body").children("p").eq(0).text(msg);				
		    $('#modal-reminder').modal();				
		}
		
		function addColumn(result){
			var html="<tr>";
			html+="<td width=10%>"+result.result.id+"</td>";               
			html+="<td width=80%><a  class=\"editable editable-click\" href=\"#\" data-type='text'";
			html+="data-original-title='' title='' data-title='enter new name'";
			html+="data-pk="+result.result.id+" id=\"cate_name\">"+result.result.name+"</a></td>";         
			html+="<td width=10%><a class='btn-link' data-toggle=\"popover\" href='#' data-id="+result.result.id+">delete</a></td>";
			html+="</tr>";				     
			$("#tbody").append(html);
				
		}
	</script>
	<!-- Optionally, you can add Slimscroll and FastClick plugins.
     Both of these plugins are recommended to enhance the
     user experience. -->
</body>
</html>

